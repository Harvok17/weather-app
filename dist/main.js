(()=>{"use strict";const e=async function(e){try{const t=await Promise.race([fetch(e),(10,new Promise((function(e,t){setTimeout((function(){t(new Error("Request took too long! Timeout after 10 second"))}),1e4)})))]),a=await t.json();if(!t.ok)throw new Error(`${a.message[0].toUpperCase()+a.message.slice(1)} (${t.status})`);return a}catch(e){throw e}},t={data:{}},a=function(e,t="short"){const a="full"===t?{dateStyle:"full",timeStyle:"short"}:{timeStyle:"short"},n=new Date(1e3*e);return new Intl.DateTimeFormat(navigator.language,a).format(n)},n=async function(n){const s=Array.isArray(n)?`lat=${n[0]}&lon=${n[1]}`:`q=${n}`;try{const n=await e(`https://api.openweathermap.org/data/2.5/weather?${s}&units=metric&appid=7f84933d96924f1148daa50fdda85e85`);t.data={name:n.name,country:n.sys.country,temp:Math.round(n.main.temp),feelsLike:Math.round(n.main.feels_like),humidity:n.main.humidity,sunrise:a(n.sys.sunrise),sunset:a(n.sys.sunset),date:a(n.dt,"full"),iconBig:`https://openweathermap.org/img/wn/${n.weather[0].icon}@4x.png`,iconSmall:`https://openweathermap.org/img/wn/${n.weather[0].icon}@2x.png`,description:n.weather[0].description[0].toUpperCase()+n.weather[0].description.slice(1),unit:"metric"};const r=await e(`https://restcountries.com/v3.1/alpha/${t.data.country}`);t.data.flag=r[0].flags.svg}catch(e){throw e}},s=new class{constructor(){this._parentElement=document.querySelector(".glass__result"),this._searchBar=document.querySelector(".glass__search-bar"),this._bigCircle=document.querySelector(".circle--big"),this._smallCircle=document.querySelector(".circle--small"),this._message="What's the weather like today? ☁"}getQuery(){const e=this._searchBar.querySelector(".glass__search-input").value;return this._clearInput(),e}_clearInput(){this._searchBar.querySelector(".glass__search-input").value=""}_clear(){this._parentElement.innerHTML=""}render(e){if(!e)return;const t=`\n    <div class="glass__weather">\n      <span>Updated as of:</span>\n      <p><span>${e.date}</span></p><br>\n      <h2>${e.name}, ${e.country}</h2>\n      <div class="glass__temperature">\n          <img src="${e.iconSmall}" alt="weather icon" class="glass__weather-icon">\n          <h1>${e.temp}<sup>°${"metric"===e.unit?"C":"F"}</sup></h1>\n      </div>\n      <p>${e.description}</p>\n      <div class="glass__details">\n          <p>Feels like: ${e.feelsLike} °${"metric"===e.unit?"C":"F"}</p>\n          <p>Humidity: ${e.humidity}%</p>\n          <p>Sunrise: ${e.sunrise}</p>\n          <p>Sunset: ${e.sunset}</p>\n      </div>\n      <div class="glass__switch">\n          <div class="glass__select celcius ${"metric"===e.unit?"glass__select--active":""}" data-unit="metric">C</div>\n          <div class="glass__select fahrenheit ${"imperial"===e.unit?"glass__select--active":""}" data-unit="imperial">F</div>\n      </div>\n    </div>\n    `;this._bigCircle.style.backgroundImage=`url(${e.flag})`,this._smallCircle.style.backgroundImage=`url(${e.iconBig})`,this._clear(),this._parentElement.insertAdjacentHTML("afterbegin",t)}renderSpinner(){this._clear(),this._parentElement.insertAdjacentHTML("afterbegin",'<div class="glass__loader"></div>')}renderMessage(e=this._message){const t=`<span class="glass__text">${e}</span>`;this._clear(),this._parentElement.insertAdjacentHTML("afterbegin",t)}addHandlerRender(e){window.addEventListener("load",e)}addHandlerSearch(e){this._searchBar.addEventListener("submit",(function(t){t.preventDefault(),e()}))}addHandlerConvert(e){this._parentElement.addEventListener("click",(function(t){const a=t.target.closest(".glass__select");a&&!a.classList.contains("glass__select--active")&&e(a.dataset.unit)}))}},r=async function(e){try{const{latitude:a}=e.coords,{longitude:r}=e.coords;await n([a,r]),s.render(t.data)}catch(e){console.error(e),s.renderMessage(e.message)}};s.addHandlerRender((function(){s.renderSpinner(),navigator.geolocation&&navigator.geolocation.getCurrentPosition(r,(function(){s.renderMessage()}))})),s.addHandlerSearch((async function(){try{s.renderSpinner();const e=s.getQuery();if(!e)return;await n(e),s.render(t.data)}catch(e){console.error(e),s.renderMessage(e.message)}})),s.addHandlerConvert((function(e){!function(e){"imperial"===e&&(t.data.temp=Math.round(9*t.data.temp/5+32),t.data.feelsLike=Math.round(9*t.data.feelsLike/5+32),t.data.unit="imperial"),"metric"===e&&(t.data.temp=Math.round(5*(t.data.temp-32)/9),t.data.feelsLike=Math.round(5*(t.data.feelsLike-32)/9),t.data.unit="metric")}(e),s.render(t.data)}))})();